/*
	Copyright (c) 2004-2008, The Dojo Foundation
	All Rights Reserved.

	Licensed under the Academic Free License version 2.1 or above OR the
	modified BSD license. For more information on Dojo licensing, see:

	http://dojotoolkit.org/license

*/

/*
	This is a compiled version of Dojo, built for deployment and not for
	development. To get an editable version, please visit:

		http://dojotoolkit.org

	for documentation and information on getting the source.
*/

if(!dojo._hasResource["dojo.AdapterRegistry"]){dojo._hasResource["dojo.AdapterRegistry"]=true;dojo.provide("dojo.AdapterRegistry");dojo.AdapterRegistry=function(_1){this.pairs=[];this.returnWrappers=_1||false;};dojo.extend(dojo.AdapterRegistry,{register:function(_2,_3,_4,_5,_6){this.pairs[((_6)?"unshift":"push")]([_2,_3,_4,_5]);},match:function(){for(var i=0;i<this.pairs.length;i++){var _8=this.pairs[i];if(_8[1].apply(this,arguments)){if((_8[3])||(this.returnWrappers)){return _8[2];}else{return _8[2].apply(this,arguments);}}}throw new Error("No match found");},unregister:function(_9){for(var i=0;i<this.pairs.length;i++){var _b=this.pairs[i];if(_b[0]==_9){this.pairs.splice(i,1);return true;}}return false;}});}if(!dojo._hasResource["dojox.cometd._base"]){dojo._hasResource["dojox.cometd._base"]=true;dojo.provide("dojox.cometd._base");dojox.cometd=new function(){this.DISCONNECTED="DISCONNECTED";this.CONNECTING="CONNECTING";this.CONNECTED="CONNECTED";this.DISCONNECTING="DISCONNECING";this._initialized=false;this._connected=false;this._polling=false;this._handshook=false;this.expectedNetworkDelay=10000;this.connectTimeout=0;this.connectionTypes=new dojo.AdapterRegistry(true);this.version="1.0";this.minimumVersion="0.9";this.clientId=null;this.messageId=0;this.batch=0;this._isXD=false;this.handshakeReturn=null;this.currentTransport=null;this.url=null;this.lastMessage=null;this._messageQ=[];this.handleAs="json";this._advice={};this._backoffInterval=0;this._backoffIncrement=1000;this._backoffMax=60000;this._deferredSubscribes={};this._deferredUnsubscribes={};this._subscriptions=[];this._extendInList=[];this._extendOutList=[];this.state=function(){return this._initialized?(this._connected?"CONNECTED":"CONNECTING"):(this._connected?"DISCONNECTING":"DISCONNECTED");};this.init=function(_c,_d,_e){_d=_d||{};_d.version=this.version;_d.minimumVersion=this.minimumVersion;_d.channel="/meta/handshake";_d.id=""+this.messageId++;this.url=_c||dojo.config["cometdRoot"];if(!this.url){throw "no cometd root";return null;}var _f="^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$";var _10=(""+window.location).match(new RegExp(_f));if(_10[4]){var tmp=_10[4].split(":");var _12=tmp[0];var _13=tmp[1]||"80";_10=this.url.match(new RegExp(_f));if(_10[4]){tmp=_10[4].split(":");var _14=tmp[0];var _15=tmp[1]||"80";this._isXD=((_14!=_12)||(_15!=_13));}}if(!this._isXD){_d.supportedConnectionTypes=dojo.map(this.connectionTypes.pairs,"return item[0]");}_d=this._extendOut(_d);var _16={url:this.url,handleAs:this.handleAs,content:{"message":dojo.toJson([_d])},load:dojo.hitch(this,function(msg){this._backon();this._finishInit(msg);}),error:dojo.hitch(this,function(e){this._backoff();this._finishInit([{}]);}),timeout:this.expectedNetworkDelay};if(_e){dojo.mixin(_16,_e);}this._props=_d;for(var _19 in this._subscriptions){for(var sub in this._subscriptions[_19]){if(this._subscriptions[_19][sub].topic){dojo.unsubscribe(this._subscriptions[_19][sub].topic);}}}this._messageQ=[];this._subscriptions=[];this._initialized=true;this.batch=0;this.startBatch();var r;if(this._isXD){_16.callbackParamName="jsonp";r=dojo.io.script.get(_16);}else{r=dojo.xhrPost(_16);}dojo.publish("/cometd/meta",[{cometd:this,action:"handshake",successful:true,state:this.state()}]);return r;};this.publish=function(_1c,_1d,_1e){var _1f={data:_1d,channel:_1c};if(_1e){dojo.mixin(_1f,_1e);}this._sendMessage(_1f);};this.subscribe=function(_20,_21,_22,_23){_23=_23||{};if(_21){var _24="/cometd"+_20;var _25=this._subscriptions[_24];if(!_25||_25.length==0){_25=[];_23.channel="/meta/subscribe";_23.subscription=_20;this._sendMessage(_23);var _ds=this._deferredSubscribes;if(_ds[_20]){_ds[_20].cancel();delete _ds[_20];}_ds[_20]=new dojo.Deferred();}for(var i in _25){if(_25[i].objOrFunc===_21&&(!_25[i].funcName&&!_22||_25[i].funcName==_22)){return null;}}var _28=dojo.subscribe(_24,_21,_22);_25.push({topic:_28,objOrFunc:_21,funcName:_22});this._subscriptions[_24]=_25;}var ret=this._deferredSubscribes[_20]||{};ret.args=dojo._toArray(arguments);return ret;};this.unsubscribe=function(_2a,_2b,_2c,_2d){if((arguments.length==1)&&(!dojo.isString(_2a))&&(_2a.args)){return this.unsubscribe.apply(this,_2a.args);}var _2e="/cometd"+_2a;var _2f=this._subscriptions[_2e];if(!_2f||_2f.length==0){return null;}var s=0;for(var i in _2f){var sb=_2f[i];if((!_2b)||(sb.objOrFunc===_2b&&(!sb.funcName&&!_2c||sb.funcName==_2c))){dojo.unsubscribe(_2f[i].topic);delete _2f[i];}else{s++;}}if(s==0){_2d=_2d||{};_2d.channel="/meta/unsubscribe";_2d.subscription=_2a;delete this._subscriptions[_2e];this._sendMessage(_2d);this._deferredUnsubscribes[_2a]=new dojo.Deferred();if(this._deferredSubscribes[_2a]){this._deferredSubscribes[_2a].cancel();delete this._deferredSubscribes[_2a];}}return this._deferredUnsubscribes[_2a];};this.disconnect=function(){for(var _33 in this._subscriptions){for(var sub in this._subscriptions[_33]){if(this._subscriptions[_33][sub].topic){dojo.unsubscribe(this._subscriptions[_33][sub].topic);}}}this._subscriptions=[];this._messageQ=[];if(this._initialized&&this.currentTransport){this._initialized=false;this.currentTransport.disconnect();}if(!this._polling){this._connected=false;dojo.publish("/cometd/meta",[{cometd:this,action:"connect",successful:false,state:this.state()}]);}this._initialized=false;this._handshook=false;dojo.publish("/cometd/meta",[{cometd:this,action:"disconnect",successful:true,state:this.state()}]);};this.subscribed=function(_35,_36){};this.unsubscribed=function(_37,_38){};this.tunnelInit=function(_39,_3a){};this.tunnelCollapse=function(){};this._backoff=function(){if(!this._advice){this._advice={reconnect:"retry",interval:0};}else{if(!this._advice.interval){this._advice.interval=0;}}if(this._backoffInterval<this._backoffMax){this._backoffInterval+=this._backoffIncrement;}};this._backon=function(){this._backoffInterval=0;};this._interval=function(){var i=this._backoffInterval+(this._advice?(this._advice.interval?this._advice.interval:0):0);if(i>0){if(console.log){console.log("Retry in interval+backoff="+this._advice.interval+"+"+this._backoffInterval+"="+i+"ms");}}return i;};this._finishInit=function(_3c){_3c=_3c[0];this.handshakeReturn=_3c;if(_3c["advice"]){this._advice=_3c.advice;}var _3d=_3c.successful?_3c.successful:false;if(_3c.version<this.minimumVersion){if(console.log){console.log("cometd protocol version mismatch. We wanted",this.minimumVersion,"but got",_3c.version);}_3d=false;this._advice.reconnect="none";}if(_3d){this.currentTransport=this.connectionTypes.match(_3c.supportedConnectionTypes,_3c.version,this._isXD);this.currentTransport._cometd=this;this.currentTransport.version=_3c.version;this.clientId=_3c.clientId;this.tunnelInit=dojo.hitch(this.currentTransport,"tunnelInit");this.tunnelCollapse=dojo.hitch(this.currentTransport,"tunnelCollapse");this.currentTransport.startup(_3c);}dojo.publish("/cometd/meta",[{cometd:this,action:"handshake",successful:_3d,reestablish:_3d&&this._handshook,state:this.state()}]);if(_3d){this._handshook=true;}else{if(console.log){console.log("cometd init failed");}if(!this._advice||this._advice["reconnect"]!="none"){setTimeout(dojo.hitch(this,"init",this.url,this._props),this._interval());}}};this._extendIn=function(_3e){dojo.forEach(dojox.cometd._extendInList,function(f){_3e=f(_3e)||_3e;});return _3e;};this._extendOut=function(_40){dojo.forEach(dojox.cometd._extendOutList,function(f){_40=f(_40)||_40;});return _40;};this.deliver=function(_42){dojo.forEach(_42,this._deliver,this);return _42;};this._deliver=function(_43){_43=this._extendIn(_43);if(!_43["channel"]){if(_43["success"]!==true){return;}}this.lastMessage=_43;if(_43.advice){this._advice=_43.advice;}var _44=null;if((_43["channel"])&&(_43.channel.length>5)&&(_43.channel.substr(0,5)=="/meta")){switch(_43.channel){case "/meta/connect":if(_43.successful&&!this._connected){this._connected=this._initialized;this.endBatch();}else{if(!this._initialized){this._connected=false;}}if(this._initialized){dojo.publish("/cometd/meta",[{cometd:this,action:"connect",successful:_43.successful,state:this.state()}]);}break;case "/meta/subscribe":_44=this._deferredSubscribes[_43.subscription];if(!_43.successful){if(_44){_44.errback(new Error(_43.error));}this.currentTransport.cancelConnect();return;}dojox.cometd.subscribed(_43.subscription,_43);if(_44){_44.callback(true);}break;case "/meta/unsubscribe":_44=this._deferredUnsubscribes[_43.subscription];if(!_43.successful){if(_44){_44.errback(new Error(_43.error));}this.currentTransport.cancelConnect();return;}this.unsubscribed(_43.subscription,_43);if(_44){_44.callback(true);}break;default:if(_43.successful&&!_43.successful){this.currentTransport.cancelConnect();return;}}}this.currentTransport.deliver(_43);if(_43.data){try{var _45=[_43];var _46="/cometd"+_43.channel;var _47=_43.channel.split("/");var _48="/cometd";for(var i=1;i<_47.length-1;i++){dojo.publish(_48+"/**",_45);_48+="/"+_47[i];}dojo.publish(_48+"/**",_45);dojo.publish(_48+"/*",_45);dojo.publish(_46,_45);}catch(e){if(console.log){console.log(e);}}}};this._sendMessage=function(_4a){if(this.currentTransport&&!this.batch){return this.currentTransport.sendMessages([_4a]);}else{this._messageQ.push(_4a);return null;}};this.startBatch=function(){this.batch++;};this.endBatch=function(){if(--this.batch<=0&&this.currentTransport&&this._connected){this.batch=0;var _4b=this._messageQ;this._messageQ=[];if(_4b.length>0){this.currentTransport.sendMessages(_4b);}}};this._onUnload=function(){dojo.addOnUnload(dojox.cometd,"disconnect");};this._connectTimeout=function(){var _4c=0;if(this._advice&&this._advice.timeout&&this.expectedNetworkDelay>0){_4c=this._advice.timeout+this.expectedNetworkDelay;}if(this.connectTimeout>0&&this.connectTimeout<_advised){return this.connectTimeout;}return _4c;};};dojo.addOnUnload(dojox.cometd,"_onUnload");}if(!dojo._hasResource["dojox.cometd.longPollTransportJsonEncoded"]){dojo._hasResource["dojox.cometd.longPollTransportJsonEncoded"]=true;dojo.provide("dojox.cometd.longPollTransportJsonEncoded");dojox.cometd.longPollTransportJsonEncoded=new function(){this._connectionType="long-polling";this._cometd=null;this.check=function(_4d,_4e,_4f){return ((!_4f)&&(dojo.indexOf(_4d,"long-polling")>=0));};this.tunnelInit=function(){var _50={channel:"/meta/connect",clientId:this._cometd.clientId,connectionType:this._connectionType,id:""+this._cometd.messageId++};_50=this._cometd._extendOut(_50);this.openTunnelWith([_50]);};this.tunnelCollapse=function(){if(!this._cometd._initialized){return;}if(this._cometd._advice&&this._cometd._advice["reconnect"]=="none"){return;}if(this._cometd._connected){setTimeout(dojo.hitch(this,function(){this._connect();}),this._cometd._interval());}else{setTimeout(dojo.hitch(this._cometd,function(){this.init(this.url,this._props);}),this._cometd._interval());}};this._connect=function(){if(!this._cometd._initialized){return;}if(this._cometd._polling){return;}if((this._cometd._advice)&&(this._cometd._advice["reconnect"]=="handshake")){this._cometd._connected=false;this._initialized=false;this._cometd.init(this._cometd.url,this._cometd._props);}else{if(this._cometd._connected){var _51={channel:"/meta/connect",connectionType:this._connectionType,clientId:this._cometd.clientId,id:""+this._cometd.messageId++};if(this._cometd.connectTimeout>this._cometd.expectedNetworkDelay){_51.advice={timeout:(this._cometd.connectTimeout-this._cometd.expectedNetworkDelay)};}_51=this._cometd._extendOut(_51);this.openTunnelWith([_51]);}}};this.deliver=function(_52){};this.openTunnelWith=function(_53,url){this._cometd._polling=true;var _55={url:(url||this._cometd.url),postData:dojo.toJson(_53),contentType:"text/json;charset=UTF-8",handleAs:this._cometd.handleAs,load:dojo.hitch(this,function(_56){this._cometd._polling=false;this._cometd.deliver(_56);this._cometd._backon();this.tunnelCollapse();}),error:dojo.hitch(this,function(err){this._cometd._polling=false;dojo.publish("/cometd/meta",[{cometd:this._cometd,action:"connect",successful:false,state:this._cometd.state()}]);this._cometd._backoff();this.tunnelCollapse();})};var _58=this._cometd._connectTimeout();if(_58>0){_55.timeout=_58;}this._poll=dojo.rawXhrPost(_55);};this.sendMessages=function(_59){for(var i=0;i<_59.length;i++){_59[i].clientId=this._cometd.clientId;_59[i].id=""+this._cometd.messageId++;_59[i]=this._cometd._extendOut(_59[i]);}return dojo.rawXhrPost({url:this._cometd.url||dojo.config["cometdRoot"],handleAs:this._cometd.handleAs,load:dojo.hitch(this._cometd,"deliver"),postData:dojo.toJson(_59),contentType:"text/json;charset=UTF-8",error:dojo.hitch(this,function(err){dojo.event.topic.publish("/cometd/meta",{cometd:this,action:"publish",successful:false,state:this.state(),messages:_59});}),timeout:this._cometd.expectedNetworkDelay});};this.startup=function(_5c){if(this._cometd._connected){return;}this.tunnelInit();};this.disconnect=function(){var _5d={channel:"/meta/disconnect",clientId:this._cometd.clientId,id:""+this._cometd.messageId++};_5d=this._cometd._extendOut(_5d);dojo.rawXhrPost({url:this._cometd.url||dojo.config["cometdRoot"],handleAs:this._cometd.handleAs,postData:dojo.toJson([_5d]),contentType:"text/json;charset=UTF-8"});};this.cancelConnect=function(){if(this._poll){this._poll.cancel();this._cometd._polling=false;dojo.debug("tunnel opening cancelled");dojo.event.topic.publish("/cometd/meta",{cometd:this._cometd,action:"connect",successful:false,state:this._cometd.state(),cancel:true});this._cometd._backoff();this.disconnect();this.tunnelCollapse();}};};dojox.cometd.longPollTransport=dojox.cometd.longPollTransportJsonEncoded;dojox.cometd.connectionTypes.register("long-polling",dojox.cometd.longPollTransport.check,dojox.cometd.longPollTransportJsonEncoded);dojox.cometd.connectionTypes.register("long-polling-json-encoded",dojox.cometd.longPollTransport.check,dojox.cometd.longPollTransportJsonEncoded);}if(!dojo._hasResource["dojox.cometd.longPollTransport"]){dojo._hasResource["dojox.cometd.longPollTransport"]=true;dojo.provide("dojox.cometd.longPollTransport");}if(!dojo._hasResource["dojo.io.script"]){dojo._hasResource["dojo.io.script"]=true;dojo.provide("dojo.io.script");dojo.io.script={get:function(_5e){var dfd=this._makeScriptDeferred(_5e);var _60=dfd.ioArgs;dojo._ioAddQueryToUrl(_60);this.attach(_60.id,_60.url,_5e.frameDoc);dojo._ioWatch(dfd,this._validCheck,this._ioCheck,this._resHandle);return dfd;},attach:function(id,url,_63){var doc=(_63||dojo.doc);var _65=doc.createElement("script");_65.type="text/javascript";_65.src=url;_65.id=id;doc.getElementsByTagName("head")[0].appendChild(_65);},remove:function(id){dojo._destroyElement(dojo.byId(id));if(this["jsonp_"+id]){delete this["jsonp_"+id];}},_makeScriptDeferred:function(_67){var dfd=dojo._ioSetArgs(_67,this._deferredCancel,this._deferredOk,this._deferredError);var _69=dfd.ioArgs;_69.id=dojo._scopeName+"IoScript"+(this._counter++);_69.canDelete=false;if(_67.callbackParamName){_69.query=_69.query||"";if(_69.query.length>0){_69.query+="&";}_69.query+=_67.callbackParamName+"="+(_67.frameDoc?"parent.":"")+"dojo.io.script.jsonp_"+_69.id+"._jsonpCallback";_69.canDelete=true;dfd._jsonpCallback=this._jsonpCallback;this["jsonp_"+_69.id]=dfd;}return dfd;},_deferredCancel:function(dfd){dfd.canceled=true;if(dfd.ioArgs.canDelete){dojo.io.script._deadScripts.push(dfd.ioArgs.id);}},_deferredOk:function(dfd){if(dfd.ioArgs.canDelete){dojo.io.script._deadScripts.push(dfd.ioArgs.id);}if(dfd.ioArgs.json){return dfd.ioArgs.json;}else{return dfd.ioArgs;}},_deferredError:function(_6c,dfd){if(dfd.ioArgs.canDelete){if(_6c.dojoType=="timeout"){dojo.io.script.remove(dfd.ioArgs.id);}else{dojo.io.script._deadScripts.push(dfd.ioArgs.id);}}console.debug("dojo.io.script error",_6c);return _6c;},_deadScripts:[],_counter:1,_validCheck:function(dfd){var _6f=dojo.io.script;var _70=_6f._deadScripts;if(_70&&_70.length>0){for(var i=0;i<_70.length;i++){_6f.remove(_70[i]);}dojo.io.script._deadScripts=[];}return true;},_ioCheck:function(dfd){if(dfd.ioArgs.json){return true;}var _73=dfd.ioArgs.args.checkString;if(_73&&eval("typeof("+_73+") != 'undefined'")){return true;}return false;},_resHandle:function(dfd){if(dojo.io.script._ioCheck(dfd)){dfd.callback(dfd);}else{dfd.errback(new Error("inconceivable dojo.io.script._resHandle error"));}},_jsonpCallback:function(_75){this.ioArgs.json=_75;}};}if(!dojo._hasResource["dojox.cometd.callbackPollTransport"]){dojo._hasResource["dojox.cometd.callbackPollTransport"]=true;dojo.provide("dojox.cometd.callbackPollTransport");dojox.cometd.callbackPollTransport=new function(){this._connectionType="callback-polling";this._cometd=null;this.check=function(_76,_77,_78){return (dojo.indexOf(_76,"callback-polling")>=0);};this.tunnelInit=function(){var _79={channel:"/meta/connect",clientId:this._cometd.clientId,connectionType:this._connectionType,id:""+this._cometd.messageId++};_79=this._cometd._extendOut(_79);this.openTunnelWith({message:dojo.toJson([_79])});};this.tunnelCollapse=dojox.cometd.longPollTransport.tunnelCollapse;this._connect=dojox.cometd.longPollTransport._connect;this.deliver=dojox.cometd.longPollTransport.deliver;this.openTunnelWith=function(_7a,url){this._cometd._polling=true;var _7c={load:dojo.hitch(this,function(_7d){this._cometd._polling=false;this._cometd.deliver(_7d);this._cometd._backon();this.tunnelCollapse();}),error:dojo.hitch(this,function(err){this._cometd._polling=false;dojo.publish("/cometd/meta",[{cometd:this._cometd,action:"connect",successful:false,state:this._cometd.state()}]);this._cometd._backoff();this.tunnelCollapse();}),url:(url||this._cometd.url),content:_7a,callbackParamName:"jsonp"};var _7f=this._cometd._connectTimeout();if(_7f>0){_7c.timeout=_7f;}dojo.io.script.get(_7c);};this.sendMessages=function(_80){for(var i=0;i<_80.length;i++){_80[i].clientId=this._cometd.clientId;_80[i].id=""+this._cometd.messageId++;_80[i]=this._cometd._extendOut(_80[i]);}var _82={url:this._cometd.url||dojo.config["cometdRoot"],load:dojo.hitch(this._cometd,"deliver"),callbackParamName:"jsonp",content:{message:dojo.toJson(_80)},error:dojo.hitch(this,function(err){dojo.event.topic.publish("/cometd/meta",{cometd:this,action:"publish",successful:false,state:this.state(),messages:_80});}),timeout:this._cometd.expectedNetworkDelay};return dojo.io.script.get(_82);};this.startup=function(_84){if(this._cometd._connected){return;}this.tunnelInit();};this.disconnect=dojox.cometd.longPollTransport.disconnect;this.disconnect=function(){var _85={channel:"/meta/disconnect",clientId:this._cometd.clientId,id:""+this._cometd.messageId++};_85=this._cometd._extendOut(_85);dojo.io.script.get({url:this._cometd.url||dojo.config["cometdRoot"],callbackParamName:"jsonp",content:{message:dojo.toJson([_85])}});};this.cancelConnect=function(){};};dojox.cometd.connectionTypes.register("callback-polling",dojox.cometd.callbackPollTransport.check,dojox.cometd.callbackPollTransport);}if(!dojo._hasResource["dojox.cometd"]){dojo._hasResource["dojox.cometd"]=true;dojo.provide("dojox.cometd");}
